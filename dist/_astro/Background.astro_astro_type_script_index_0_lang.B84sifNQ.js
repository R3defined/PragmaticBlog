console.log("üé® Background script loaded");async function h(){try{console.log("üìù Loading Geist Mono font...");const a=new FontFace("Geist Mono","url(/fonts/GeistMono.woff2)");return await a.load(),document.fonts.add(a),console.log("‚úÖ Font loaded successfully"),!0}catch(a){return console.error("‚ùå Font loading failed:",a),!1}}async function r(){try{console.log("üöÄ Initializing background..."),await h()||console.warn("‚ö†Ô∏è Font loading failed, proceeding with system font");const t=document.getElementById("bg-canvas"),e=document.getElementById("overlay-canvas");if(!t||!e){console.error("‚ùå Canvas elements not found");return}console.log("üéØ Canvas elements found:",{canvas:t,overlayCanvas:e});const o=getComputedStyle(document.documentElement).getPropertyValue("--primary-rgb").trim();if(console.log("üé® Primary RGB:",o),!o){console.error("‚ùå Primary RGB color not found");return}const s=new c(t,e);console.log("‚úÖ Background initialized successfully"),window.addEventListener("resize",()=>{s.resizeBackground()})}catch(a){console.error("‚ùå Background initialization failed:",a)}}class c{LETTER_FADE_DURATION=[2,7];baseCanvas;overlayCanvas;baseCtx;overlayCtx;width=window.innerWidth;height=window.innerHeight;letterPositions=[];letterInstances=[];primaryRgb;constructor(t,e){console.log("üèóÔ∏è Creating PageBackground instance");const o=t.getContext("2d"),s=e.getContext("2d");if(!o||!s)throw new Error("Unable to get 2D context.");this.baseCanvas=t,this.overlayCanvas=e,this.baseCtx=o,this.overlayCtx=s,t.width=this.width,t.height=this.height,e.width=this.width,e.height=this.height,this.primaryRgb=getComputedStyle(document.documentElement).getPropertyValue("--primary-rgb").trim(),console.log("üé® Using primary RGB:",this.primaryRgb),this.initBackground(),requestAnimationFrame(this.redrawBackground)}initBackground=()=>{console.log("üéØ Initializing background pattern");let t=document.title.toLowerCase().split(" | ")[0].replace(/\s/g,"_")||"pragmatic_cipher";t.includes("_")&&(t+="_");const e=Math.ceil(this.width/17),o=Math.ceil(this.height/35);console.log(`üìè Canvas size: ${this.width}x${this.height}, Letters: ${e}, Lines: ${o}`),this.baseCtx.font="28px Geist Mono, monospace",this.baseCtx.textAlign="start",this.baseCtx.textBaseline="top",this.baseCtx.fillStyle="rgba(255, 255, 255, 0.01)";for(let i=0;i<o;i++)for(let n=0;n<e;n++)this.baseCtx.fillText(t[n%t.length],n*17,i*35),this.letterPositions.push({x:n*17,y:i*35,letter:t[n%t.length]});const s=this.getRandomAmountFromArray(this.letterPositions,Math.floor(o*.75));this.overlayCtx.font="bold 28px Geist Mono, monospace",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, 0)`,this.overlayCtx.shadowBlur=16,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, 0)`;for(const i of s){this.overlayCtx.fillText(i.letter,i.x,i.y);const n=this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]);this.letterInstances.push({x:i.x,y:i.y,letter:i.letter,timestamp:Date.now(),fadeout:Date.now()+n*1e3})}this.baseCanvas.style.opacity="1",console.log("‚úÖ Background pattern initialized")};getRandomAmountFromArray=(t,e=20)=>{let o=t.length;const s=new Array(e),i=new Array(o);if(e>o)throw new Error("getRandomAmountFromArray: more elements taken than available");for(;e--;){const n=Math.floor(Math.random()*o);s[e]=t[n in i?i[n]:n],i[n]=--o in i?i[o]:o}return s};easeInOutSine=(t,e,o)=>{const s=o-e;if(t<e)return 0;if(t>o){const l=(t-o)/(s/2);return Math.sin(l*Math.PI)}const i=(t-e)/s;return Math.max(0,.5-.5*Math.cos(i*Math.PI))};redrawBackground=()=>{this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.overlayCtx.font="bold 28px Geist Mono, monospace",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.shadowBlur=16;for(const t of this.letterInstances){if(t.fadeout>Date.now())continue;const e=this.easeInOutSine(Date.now(),t.timestamp,t.fadeout);if(e<=0&&Date.now()>t.fadeout){this.letterInstances.splice(this.letterInstances.indexOf(t),1);const o=this.getRandomAmountFromArray(this.letterPositions,1);this.letterInstances.push({x:o[0].x,y:o[0].y,letter:o[0].letter,timestamp:Date.now(),fadeout:Date.now()+(this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]))*1e3})}this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.fillText(t.letter,t.x,t.y)}requestAnimationFrame(this.redrawBackground)};resizeBackground=()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.baseCanvas.width=this.width,this.baseCanvas.height=this.height,this.overlayCanvas.width=this.width,this.overlayCanvas.height=this.height,this.baseCtx.clearRect(0,0,this.baseCanvas.width,this.baseCanvas.height),this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.letterInstances=[],this.letterPositions=[],this.initBackground()}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r();
